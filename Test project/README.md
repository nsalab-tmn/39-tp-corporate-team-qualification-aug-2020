# Сетевая инфраструктура

В вашем распоряжение имеется 2 виртуальных маршрутизатора Cisco CSR 1000v:
Hostname | Login  | Pass
---------|--------|-----
WIN-EDGE | azadmin|4eEAV4_H!M^a
LNX-EDGE | azadmin|4eEAV4_H!M^a

## Инструкции для участника
* Не назначайте IP-адреса и не выключайте интерфейсы. IP-адреса Azure назначает автоматически используя DHCP.
* Не настраивайте AAA.
* Не меняйте текущие настройки в VRF GS. Это служебный VRF, используемый Azure.

## Задачи

### Настройте NAT:
* Все виртуальные машины в Windows сайте должны иметь доступ в интернет.
* Все виртуальные машины в Linux сайте должны иметь доступ в интернет.
* Настройте возможность использования приложения в Linux сайте из сети Интернет.
* Настройте возможность разрешения имен, делегированной вам зоны, из сети Интернет.

###  Настройте IPSec VPN между двумя сайтами:
* Используйте IKEv2.
* Используйте сертификаты, выписанные CA.
```
Особенности работы с Azure:
1. Используйте mode transport в IPSec профиле.
2. Не используйте GRE. 
```
### Настройте OSPF между двумя сайтами.
* Используйте аутентификацию.

______________________
# Инфраструктура на базе ОС Linux 

В вашем распоряжение имеется 4 виртуальные машины:
Hostname | Роль             | OS          | Login  | Pass
---------|------------------|-------------|--------|-----
app      | Сервер приложения|Ubuntu 18.04 | azadmin|4eEAV4_H!M^a
dns      | Сервер имен      |Ubuntu 18.04 | azadmin|4eEAV4_H!M^a
db       | База данных      |Ubuntu 18.04 | azadmin|4eEAV4_H!M^a
cache    | Кэш              |Ubuntu 18.04 | azadmin|4eEAV4_H!M^a


По мере выполения задания вам потребуется скачать приложение, см. каталог `application` данного репозитория.
Более того, вам делегирована зона `comp##.itsc.skillscloud.company`, где ## - ваш индивидуальный номер учатсника, следующим образом:
```
comp##.itsc.skillscloud.company        NS   ns.comp##.itsc.skillscloud.company
ns.comp##.itsc.skillscloud.company     A   <Public IP on linux-site router>
```

# Задачи

## DNS
* Установите на `dns` сервер разрешения имен по своему усмотрению
* Добавьте A запись `app` с публичным адресом сервера `app` в качестве значения 
* Убедитесь, что публиный DNS (1.1.1.1) способен разрешить имя `app.comp##.itsc.skillscloud.company`

## Приложение
* Скачайте дистрибутив приложения на сервер `app`
* Ознакомьтесь с файлом `config.yaml`. **Не удаляйте параметры из конфига, даже если они вам не нужны!**. Однако, вы можете менять значения параметров по мере необходимости
* Для функционирования веб приложения не обязательно иметь скофигурированую базу данных и кэш
* Вы можете запустить веб-сервер командой `./server`. Обратите внимание, что файл `config.yaml` должен присутсвовать в той папке, откуда производится запуск приложения
* После запуска, функционирование приложения можно проверить http запросом на указанный в конфиге порт (по умолчанию 8080)
* Возможные проблемы и ошибки будут отображаться в stdout
* Убедитесь, что ваше приложение продолжает работать после завершения ssh сессии

## База данных
* Установите `mysql` сервер на виртуальной машине `db`
* Создайте базу данных.
* Создавать таблицу `tasks` необязательно
* Обеспечне доступность базы данных с сервера `app`
* Поправьте конфиг на сервере приложения в соответсвии с настройками базы данных
* Убедитесь на странице `/status`, что приложению база данных доступна

## Кэш
* Установаните `redis` сервер на виртуальной машине `cache`
* Обеспечне доступность базы данных с сервера `app`
* Поправьте конфиг на сервере приложения в соответсвии с настройками кэша
* Убедитесь на странице `/status`, что приложению кэш доступен

## HTTPS
* Ваше приложение должно быть доступно по адресу `https://app.comp##.itsc.skillscloud.company`. Поскольку приложение может работать только по протоколу http - вам потребует реверс-прокси сервер (какой вам больше нравится) 
* Сконфигурируйте редирект с кодом 301 http -> https
* Обеспечьте передачу заголовка `Host` к приложению
* Используйте публичный сертификат Let's Encrypt для `https`

______________
# Инфраструктура на базе ОС Microsoft Windows

Hostname | Роль             | IP адрес    | OS                | Login  | Pass
---------|------------------|-------------|-------------------|--------|------------
| DC-01  |Контроллер домена |10.10.1.10   |Windows Server 2016|azadmin |4eEAV4_H!M^a
| CA-01  |Сервер PKI        |10.10.1.11   |Windows Server 2016|azadmin |4eEAV4_H!M^a
| FS-01  |Файловый сервер   |10.10.1.12   |Windows Server 2016|azadmin |4eEAV4_H!M^a
| CLI-01 |Клиент            |10.10.1.20   |Windows 10         |azadmin |4eEAV4_H!M^a

 
# Задачи

## DC
- Разверние домен **gpn.wsr**
- Создайте зоны прямого и обратного просмотра.
- Обеспечьте пересылку запросов, относящихся к зоне comp##.itsc.skillscloud.company, на сервер DNS (сервер имён в линукс-сегменте),а остальных (не относящихся к gpn.wsr) на сервер 8.8.8.8. 
- Создайте подразделения: IT, DEV, MGMT, Servers, Clients.
- В подразделениях IT, DEV, MGMT создайте одноименные доменные группы.
- В каждой группе создайте с помощью скрипта по 30 пользователей.
>Все учетные записи должны иметь возможность входа в домен с логином, созданным по следующему шаблону: 
>НазваниеГруппы_ПорядковыйНомерПользователя@gpn.wsr. (например it_01@gpn.wsr)
>В качестве пароля используйте P@ssw0rdX(например P@ssw0rd01), где X – номер пользователя 
>Все учетные записи пользователей должны быть включены.
>Пользователи должны иметь возможность авторизоваться на клиенской машине.(для авторизации через Bastion пользователи должны быть в группе RDP Users на виртуальной машине CLI )
- Все используемые виртуальные машины должны быть добавлены в домен и перемещены в соответствующие подразделения.

## CA
  
- Разверните центр сертификации.
- Имя центра сертификации GPNCA;
- Срок действия сертификата – 6 лет;
- Настройте шаблон выдаваемого сертификата для клиентских компьютеров CliCert: subject name=common name и автоматизируйте их выдачу.
- настройте шаблон выдаваемого сертификата UserCert: subject name=common name и автоматизируйте их выдачу.

## FS
- В корне диска С: создайте общий ресурс для обмена файлами "storage".
- Создайте общие папки для подразделений по адресу FS-01\storage\departments. 
- Настройте права доступа таким образом, чтобы просматривать и редактировать файлы в папках могли члены соответствующей группы.
- Обеспечьте привязку общей папки подразделения к соответствующей группе пользователей в качестве диска G:.
- У администраторов предприятия должен быть полный доступ к общем ресурсам.
- Создайте в папке каждого отдела по 20  файлов. Файлы должны создержать название отдела и порядковый номер. (размер, содержимое и расширение остаётся на совести участника)
- Запретите хранение в в папках отдела исполняемых файлов.

## CLI
- Пользователям из групп DEV и MGMT не должны иметь возможность вызывать редактор реестра и командную строку.
- У пользователей при первом логине на рабочем столе должны быть иконки Internet Explorer и WordPad
 
# Нюансы и детали
>Производить настойку сети **не нужно**, она преднастроена, 
>попытки перенастроить её могут привести к неприятным последствиям для вашего стенда.

>Для доступа через Bastion требуется, чтобы учетная запись была членом группы Remote Desktop Users.

>Рекомендуется использовать предоставленные логин/пароль для
>развертывания домена (если вы собираетесь это делать).
>Неиспользование предоставленного логина/пароля для развертывания
>домена, снизит до нуля желание проверять ваш стенд

# Типс энд трикс
>Не обязательно пользоваться для доступа к виртуальным машинам 
>предоставленными логином/паролем.
>Можно создать своего доменного или локального пользвателя.
>Им можно пользоваться для доступа через Bastion.
__________________
# Диаграмма
![](layout.jpg)
